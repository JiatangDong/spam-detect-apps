<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js" type="text/javascript"></script>
    <script src="/dictionary.js" type="text/javascript"></script>
    <script>
      const MODEL_JSON_URL = '/SPAM_DETECT_JS/tfjs/model.json';
      const SPAM_THRESHOLD = 0.75;
      const ENCODING_LENGTH = 20;

      function tokenize(wordArray) {
        // Always start with the START token.
        let returnArray = [START];
        
        // Loop through the words in the sentence you want to encode.
        // If word is found in dictionary, add that number else
        // you add the UNKNOWN token.
        for (var i = 0; i < wordArray.length; i++) {
          let encoding = LOOKUP[wordArray[i]];
          returnArray.push(encoding === undefined ? UNKNOWN : encoding);
        }
        
        // Finally if the number of words was < the minimum encoding length
        // minus 1 (due to the start token), fill the rest with PAD tokens.
        while (i < ENCODING_LENGTH - 1) {
          returnArray.push(PAD);
          i++;
        }
        
        // Log the result to see what you made.
        // console.log([returnArray]);
        
        // Convert to a TensorFlow Tensor and return that.
        return tf.tensor([returnArray]);
      }

      async function run(messages) {
        model = await tf.loadLayersModel(MODEL_JSON_URL);
        // var inputTensor = tf.tensor([[1,3,12,18,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);
        
        messages.forEach(async (message) => {
          var result = await model.predict(tokenize(message))
          result.data().then((dataArray)=>{
            console.log(message, dataArray[0])
          })
        });

      }

      var reviews = [
        "hello my name",
        // "Your package is waiting for delivery. Please confirm the settlement of $19.99 on the following link: http://aka.ms/adfuyiwy",
        // "NHS: we have identified that you are eligible to apply for your vaccine. For more information and apply, follow here: application-ukform.com",
        // "I've finally arrived to Vancouver. Already found the office",
        // "watching Project Volterra a DevBox / Mini Gaming PC and other cool stuff from MS Build: https://www.youtube.com/watch?v=yICVNta8jMU",
        // "It's June and one of my neighbors still have Christmas tree on their deck",
        // "What's the difference between the red and the black coat? Is it like belt colors in karate?"
        "hello word"
      ]

      run(reviews)
    </script>
  </head>  
  <body>
    
  </body>
</html>